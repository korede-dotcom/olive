<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0 maximum-scale=1 user-scalable=0">
    <title>G-FACTOR </title>
    <link rel="icon" href="/assest/OLIVE/logo.png">
    <!-- <link rel=" stylesheet" href="/styles/auth.css"> -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300&display=swap" rel="stylesheet"> -->
    <link rel="stylesheet" href="https://unpkg.com/swiper@7/swiper-bundle.min.css" />

    <!-- <link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,300;1,900&display=swap" rel="stylesheet"> -->
    <script src="https://checkout.flutterwave.com/v3.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"
        integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB"
        crossorigin="anonymous"></script>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.3/js/intlTelInput.min.js"></script>
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.3/css/intlTelInput.min.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Khand:wght@400;600&family=Mulish:wght@300&display=swap"
        rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/particlesjs/2.2.2/particles.min.js"></script>
    <!-- <script src="https://api.ravepay.co/flwv3-pug/getpaidx/api/flwpbf-inline.js"></script> -->

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'khand', sans-serif;
            /* background-image: linear-gradient(135deg, #667eea 0%, #764ba2 100%); */

            color: #ddd;

            /* background-image: url("/assest/GODFACTOR/wave.svg"); */
            /* background-image: url("/assest/OLIVE/duotone.png"); */
            /* background-image: url("/assest/OLIVE/patternpad.svg"); */
            background-repeat: no-repeat;
            background-position: bottom;
            background-size: contain;
            animation: fadein 2s;
            height: 100vh;
            overflow-y: scroll;
        }

        /* keyframe change background image */

        .container {
            background-color: #27184f;

            height: 100vh;
            overflow-y: scroll;
            /* background: #ffffff; */
            /* border: 1px solid #fff; */
            /* border-radius: 20px; */
            /* background-image: url("/assest/GODFACTOR/blob-r.svg"); */

            /* background-image: linear-gradient(to top, #9795f0 0%, #fbc8d4 100%); */
        }

        .content {
            background-color: transparent !important;
            /* height: 50%; */

            /* background-image: url("/assest/GODFACTOR/wave.svg"); */
        }





        header {
            background-color: inherit !important;
        }

        .imageOne {
            height: 100Vh;
            /* background-image: url("/assest/OLIVE/duotone2.png"); */
            /* background-image: url("/assest/OLIVE/cool-background.png"); */
            background-image: url("/assest/OLIVE/dap.png");
            /* animation: change 2s ease 1s 2 forwards; */

            background-position: center;
            background-size: cover;
            background-repeat: no-repeat;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2em;
            color: #F2C033;

            /* border: #88266F 1px solid; */
        }

        .onetext {
            border-bottom: #88266F 4px solid;
        }

        .onetext h5 {
            color: #ffffff;
            font-family: 'Mulish', sans-serif;
            /* box-shadow: 0px 0px 10px #fcfcfc; */
        }

        .wrapper {
            /* background-image: url("/assest/OLIVE/duotone2.png"); */
            display: grid;
            grid-template-columns: 2fr 1fr;



        }

        @keyframes change {
            0% {
                background-image: url("/assest/OLIVE/dap2.png");
            }

            50% {
                background-image: url("/assest/OLIVE/dap-guitar.png");
            }

            100% {
                background-image: url("/assest/OLIVE/dap.png");
            }



        }

        .menubar {
            height: 25px;
        }

        .boxs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            grid-gap: 2px;
            /* place-items: center; */
            /* height: 80vh; */
            /* color: #f56468; */
            /* align-content: center; */
            color: #000;
            /* height: 90vh; */
            font-family: 'Mulish', sans-serif;
            /* border: 1px solid #F2C033; */
            padding: 1em;
            /* border: 2px solid #857d9b; */
            text-align: center;
            /* align-content: center; */


        }

        .boxs a {
            text-decoration: none;
        }



        .box:hover {
            /* background-color: #F2C033;
            /* color: #fff; */
            border: 1px solid #F2C033;
            align-content: center;
            /* color: #f56468 !important; */
            /* background-color: #000; */
            cursor: pointer;



        }

        .bo {


            /* border: 1px solid #F2C033; */
            padding: 1em;
            box-shadow: 3px 2px 1px #27184f;

            cursor: pointer;
        }

        .bo:hover {
            /* background-color: #857d9b; */
            color: #fff;
            border: 1px solid #F2C033;
            box-shadow: 3px 2px 1px #27184f;
            align-content: center;
            /* color: #f56468 !important; */
            /* background-color: #000; */
            cursor: pointer;
        }

        .box {
            /* border: 2px solid #88266F; */
            /* border: 1px solid #857d9b; */
            grid-gap: 10px;
            padding: 1em;
            /* display: grid; */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            border-radius: 10px;
            /* background-color: #ddd; */




        }


        .box h5 {
            color: #F2C033;
        }

        .box img {
            height: 50px;
            width: 50px;

        }


        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.1em .4em;
            height: 10vh;
            position: relative;
            /* background-color: #f56468 !important; */
        }

        .navlink {
            display: none;
            /* display: flex; */
            flex-direction: column;
            justify-content: center;
            align-items: flex-end;
            padding: 0 20px;
            position: absolute;
            top: 50px;
            right: 0;
            width: 100%;
            height: 80vh;
            /* margin: auto 0; */
            color: #000;
            background-color: #27184f;
            z-index: 1;
            /* transition: all 0.5s ease-in; */



        }

        .navlink a {
            color: #857d9b;
            text-decoration: none;
            font-size: 1.5em;
            /* border: #F2C033 1px solid; */
            padding: 1.5em;
        }

        .navlink a:hover {
            color: #F2C033;
        }

        /* .bo {
            background: linear-gradient(145deg, #790AE9, #53079F);
            border-radius: 15%;
            box-shadow: 9.91px 9.91px 15px #5D07B2, -9.91px -9.91px 15px #6F09D6;
        } */
        .content h4 {
            text-align: center;
            /* border-bottom: 1px solid #F2C033; */
        }

        @media screen and (max-width: 40em) {

            /* .navlink {
                display: block;
            } */
            body {
                /* background-image: url("/assest/OLIVE/duotone2.png"); */
            }

            .wrapper {
                grid-template-columns: 1fr;
                height: 100%;
                /* height: 100vh; */
            }

            .imageOne {
                display: none;
            }

            header {
                position: fixed;
                inset: 0;
                z-index: 1;
            }

            .content {
                height: 100%;
                /* background-image: url("/assest/OLIVE/wave2.svg"); */
                background-image: url("/assest/OLIVE/duotone8.png");
                object-fit: contain;
                background-position: bottom;
                background-size: cover center;
                background-repeat: no-repeat;
                padding-top: 90px;
                /* display: grid;
                padding: 1em;
                text-align: center !important; */

            }

            .boxs {
                /* border: 2px solid #857d9b; */
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                grid-gap: 10px;
                border-radius: 16px;
            }

            .box {
                /* text-align: center; */
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;

                height: 100%;
                /* border: #27184f 1px solid; */
                border-radius: 20px;
                /* background-color: #ddd; */

            }

            .availableformobile {
                display: initial;
            }

            .navlink {
                padding: 20px;
            }

            .bo {
                box-shadow: 2px 2px 2px 1px rgba(0, 0, 0, 0.2) !important;
            }

        }

        .shownav {
            display: flex;

        }

        .auditionText {
            font-size: 1em;
            color: #F2C033;
        }

        .round {
            border-radius: 50%;
            height: 80px;
            width: 80px;
            object-fit: contain center;
            border: 2px solid #F2C033;
        }

        .active {
            color: #F2C033 !important;
        }

        .err {
            color: #F2C033 !important;
        }

        .userName {
            pointer-events: none;
            color: #88266F !important;
            border-radius: 20%;
        }
    </style>


</head>

<body>
    <div class="wrapper">
        <div class="imageOne">
            <div class="onetext">

                <h2><span style="color: #88266F;">G</span>-FACTOR</h2>
                <h5>digital Audition Platform</h5>
            </div>
        </div>



        <div class="container">
            <header>
                <div class="logo">
                    <a href="/dashboard">

                        <img src="/assest/OLIVE/logo.png" alt="">
                    </a>
                </div>
                <div class="icon">
                    <div class="user">
                        <!-- <a href="/profile">
                        <img class="imgicon" src="/assest/OLIVE/usergold.png" alt="" srcset="">
                    </a> -->
                    </div>
                    <div id="nav">
                        <div class="home">
                            <img class="menubar" src="/assest/OLIVE/dashboard.png" alt="" srcset="">
                        </div>
                    </div>

                </div>
                <div class="navlink">
                    <a href="#" class="userName">

                        Hi ! <%= user.name %>
                    </a>
                    <a href="/dashboard">home</a>
                    <a href="/digitalauditionplatform" class="active">digitalauditionplatform</a>
                    <a href="/profile">profile</a>
                    <a href="/logout">logout</a>

                </div>
            </header>

            <section class="content">
                <h4 class="content_header"">My Auditions</h4>
                <div class=" boxs" id="">
                    <% if (audition===[]) { %>
                        <p>you have not join any audition</p>
                        <% } %>
                            <% if (audition) { %>

                                <% audition.forEach(element=> { %>

                                    <div class="bo" id="myaudition">

                                        <!-- style="background-color: transparent; border: 1.5px solid #FFCA00;border-radius: 12px;max-width: 148px; max-height: 148px;" -->
                                        <img class="round" src=<%=element.auditionLogo %>>

                                        <h6 class="content_header audition auditionText " data-id="<%=element._id %>"
                                            data-provider="<%=element.provider %>">
                                            <%= element.auditionName %>
                                        </h6>

                                    </div>


                                    <% }) %>
                                        <% } %>
        </div>
        <!-- mobile -->
        <section class="availableformobile">

            <h4 class="content_header">Available Auditions</h4>

            <div class="boxs">
                <% if (auditions) { %>

                    <% auditions.forEach(element=> { %>

                        <div class="bo all" id="all">

                            <!-- style="border: 1.5px solid #FFCA00;border-radius: 15px;box-sizing: border-box; max-width: 147px; max-height: 148px;min-width: 148px; min-height: 147px;" -->
                            <img class="round" src=<%=element.auditionLogo %>>

                            <h6 class="content_header audition availableAudition auditionText"
                                data-id="<%=element._id %>" data-provider="<%=element.provider %>"
                                data-price="<%=element.auditionPrice%>">
                                <%= element.auditionName %>
                            </h6>
                            <% if(element.auditionPrice> 0){ %>
                                <p class="content_header audition" hidden>
                                    &#x20A6; <span class="price">
                                        <%= element.auditionPrice %>
                                    </span>
                                </p>
                                <div class="detect">
                                    <img height="25px" src="/assest/OLIVE/money.png" alt="" srcset="">
                                    <!-- <small>Paid</small> -->
                                </div>

                                <!-- <button type="button" onClick="makePayment()">Pay Now</button> -->
                                <% } else { %>
                                    <p class="content_header audition" hidden>
                                        <span>
                                            <%= element.auditionPrice - element.auditionPrice %>
                                        </span>
                                    </p>
                                    <div class="detect">
                                        <img height="25px" src="/assest/OLIVE/free.png" alt="" srcset="">
                                        <!-- <small>free</small> -->
                                    </div>
                                    <% } %>
                        </div>


                        <% }) %>
                            <% } %>
            </div>




        </section>
        </section>



        <!-- <div class="" style="background-color: rgb(16, 16, 16);">
        <div class="footer_social">
            <div>
                <p><span style="color: #ddd;">&copy; 2021</span> GhenGhen </p>
            </div>
            <div class="social_icon">
                <img src="/assest/OLIVE/fb.png" />
                <img src="/assest/OLIVE/instagram.png" />
                <img src="/assest/OLIVE/twitter.png" />
            </div>
        </div> -->
    </div>
    <script src="https://checkout.flutterwave.com/v3.js" id="flutter"></script>
    <script>
        const user_id = "<%= user._id %>"
        const auditions = document.querySelectorAll("#all");
        auditions.forEach(element => {

            console.log(element);
            element.addEventListener("click", (e) => {
                const parent = e.target.parentElement;
                // console.log(parent)
                // const id = parent.querySelector('.audition').getAttribute("data-id");
                // const provider = parent.querySelector('.audition').getAttribute("data-provider");
                // const logo = parent.querySelector('img').getAttribute("src");
                const price = parent.querySelector('.audition').getAttribute("data-price");
                console.log(price)





                if (e.target.parent.querySelector('.audition').getAttribute("data-price") > 0) {
                    fetch("/check", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            id: id,
                        })
                    }).then(res => res.json())
                        .then(data => {
                            console.log(data);
                            if (data.status === "paid") {
                                function makePayment() {

                                    FlutterwaveCheckout({
                                        public_key: "FLWPUBK_TEST-ee16b8429467881fb5912f6e31e72a52-X",
                                        tx_ref: `${id}${Date.now()}`,
                                        amount: price,
                                        currency: "NGN",
                                        country: "NG",
                                        payment_options: " ",
                                        // redirect_url: // specified redirect URL
                                        //     `http://localhost:1200/paidaudition?audition=${id}&provider=${provider}&user=${user_id}`,
                                        meta: {
                                            consumer_id: 23,
                                            consumer_mac: "92a3-912ba-1192a",
                                        },
                                        customer: {
                                            email: "<%=user.email%>",
                                            phone_number: "<%= user.username %>",
                                            name: "G-FACTOR Live tution",
                                        },
                                        callback: function (datas) {
                                            fetch("/paid", {
                                                method: "POST",
                                                headers: {
                                                    "Content-Type": "application/json",
                                                },
                                                body: JSON.stringify({
                                                    data: datas,
                                                    user: '<%=user._id%>',
                                                    audition: id,


                                                })
                                            }).then(res => res.json())
                                                .then(data => {
                                                    console.log(data);
                                                    if (data.status) {
                                                        window.location.assign(`/payment/success`);
                                                    } else {
                                                        window.location.assign("/digitalauditionplatform")
                                                    }
                                                })
                                        },
                                        onclose: function () {
                                            window.location.assign("/digitalauditionplatform")
                                        },
                                        customizations: {
                                            title: "GhenGhen Live",
                                            description: "G-FACTOR tution for <%=auditions.auditionName%>",
                                            logo: logo,
                                        },
                                    });
                                }

                                makePayment()
                            }

                            // else {
                            //     // post all details to the server
                            //     fetch("/free", {
                            //         method: "POST",
                            //         headers: {
                            //             "Content-Type": "application/json",
                            //         },
                            //         body: JSON.stringify({
                            //             user: '<%=user._id%>',
                            //             audition: id,
                            //         })
                            //     }).then(res => res.json())
                            //         .then(data => {
                            //             console.log(data);
                            //             if (data.status) {
                            //                 window.location.assign(`
                            //                 /auditions/${data.status}`
                            //                 );
                            //             } else {
                            //                 window.location.assign("/digitalauditionplatform")
                            //             }
                            //         })
                            // }
                        })




                }
            });
        });

        const myaudition = document.querySelectorAll("#myaudition");

        if (myaudition) {
            myaudition.forEach(element => {
                // element.addEventListener("click", (e) => {
                const parent = element.parentElement;
                console.log(parent)
                const id = element.querySelector('.audition').getAttribute("data-id");
                console.log(id)
                const availableAudition = document.querySelectorAll(".availableAudition");
                element.addEventListener("click", (e) => {
                    // remove script from the page

                    window.location.assign(`/auditions/${id}`)
                })
                availableAudition.forEach(element => {
                    if (element.getAttribute("data-id") === id) {
                        element.parentElement.style.display = "none";
                    }
                })

                // });
            })

        }
        // const API_publicKey = "<ADD YOUR PUBLIC KEY HERE>";

        // function payWithRave() {
        //     var x = getpaidSetup({
        //         PBFPubKey: API_publicKey,
        //         customer_email: "user@example.com",
        //         amount: 2000,
        //         customer_phone: "234099940409",
        //         currency: "NGN",
        //         txref: "rave-123456",
        //         meta: [{
        //             metaname: "flightID",
        //             metavalue: "AP1234"
        //         }],
        //         onclose: function () { },
        //         callback: function (response) {
        //             var txref = response.data.txRef; // collect txRef returned and pass to a                    server page to complete status check.
        //             console.log("This is the response returned after a charge", response);
        //             if (
        //                 response.data.chargeResponseCode == "00" ||
        //                 response.data.chargeResponseCode == "0"
        //             ) {
        //                 // redirect to a success page
        //             } else {
        //                 // redirect to a failure page.
        //             }

        //             x.close(); // use this to close the modal immediately after payment.
        //         }
        //     });
        // }
    </script>


    <script>
        const imageOne = document.querySelector('.imageOne');
        const formobile = document.querySelector('.content');
        // check media query for mobile
        const ImagesArr = ["/assest/OLIVE/duotone9.png", "/assest/OLIVE/duotone4.png", "/assest/OLIVE/duotone5.png"]
        if (window.matchMedia("(max-width: 40em)").matches) {

            setInterval(() => {
                // change imageOne background image with transition
                // transition duration is 2 seconds
                formobile.style.transition = "background-image 5s linear";
                formobile.style.backgroundImage = `url(${ImagesArr[Math.floor(Math.random() * ImagesArr.length)]})`;
                console.log(ImagesArr[Math.floor(Math.random() * ImagesArr.length)])


            }, 5000);
        }

        setInterval(() => {
            // change imageOne background image with transition
            // transition duration is 2 seconds
            imageOne.style.transition = "background-image 5s linear";
            imageOne.style.backgroundImage = `url(${ImagesArr[Math.floor(Math.random() * ImagesArr.length)]})`;
            console.log(ImagesArr[Math.floor(Math.random() * ImagesArr.length)])


        }, 5000);
    </script>

    <%- include("./partials/footer.ejs") %>